<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h2>AJAX响应（Response）与多任务执行AJAX方法传参</h2>
<button type="button" onclick="loadXMLDoc()">请求数据/获取图书列表</button><br/>
<span>TEST1：</span><div id="myDiv">暂无数据</div>
<span>TEST2：</span><div id="myDiv2">暂无数据</div>

<button type="button" onclick="myFunction()">请求数据</button><br/>
<span>TEST3：</span><div id="myDiv3">暂无数据</div>
<script>
    function loadXMLDoc() {
        var xmlhttp;
        if(window.XMLHttpRequest){
            xmlhttp=new XMLHttpRequest();
        }else{
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function(){
            document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
            if (xmlhttp.readyState==4 && xmlhttp.status==200){
                xmlDoc=xmlhttp.responseXML;
                txt="";
                x=xmlDoc.getElementsByTagName("title");
                for (i=0;i<x.length;i++)
                {
                    txt=txt + x[i].childNodes[0].nodeValue + "<br />";
                }
                document.getElementById("myDiv2").innerHTML=txt;
            }
        };
        xmlhttp.open("GET","books.xml",true);
        xmlhttp.send();
    }


    /*使用 Callback 函数
    * callback 函数是一种以参数形式传递给另一个函数的函数
    * 如果您的网站上存在多个 AJAX 任务，那么您应该为创建 XMLHttpRequest 对象编写一个标准的函数，并为每个 AJAX 任务调用该函数
    * 该函数调用应该包含 URL 以及发生 onreadystatechange 事件时执行的任务（每次调用可能不尽相同）*/
    function loadXMLDoc2(url,cfunc) {//cfunc 是就绪状态执行的方法，只是上面方法的变形
        if(window.XMLHttpRequest){
            xmlhttp=new XMLHttpRequest();
        }else{
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=cfunc;
        xmlhttp.open("GET",url,true);
        xmlhttp.send();
    }
    
    function myFunction() {
        loadXMLDoc2("books.xml",function () {
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                document.getElementById("myDiv3").innerHTML=xmlhttp.responseText;
            }
        });
    }
</script>
</body>
</html>